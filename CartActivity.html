<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">


<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cart Activity</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>

</head>

<body>
  <div class="max-w-10xl mx-auto px-10 sm:px-10"></div>
  <div class=" items-center border-gray-100 py-6 md:justify-start  text-white bg-cyan-600">

    <div class="flex justify-between">
      
        <span class="sr-only">Workflow</span>
        
        <button class="ml-20 navbar-brand flex  text-2xl font-extrabold" onclick="window.location = 'https\:/\/a7.cpe231.kmutt.in.th/Account.html';" >Activity
        </button>
        <div class="flex">
        <span class="sm:block ml-3">
          <button onclick="window.location = 'https\:/\/a7.cpe231.kmutt.in.th/BookLog.html';" type="button"
            class="inline-flex items-center px-10 py-2 border-gray-300 rounded-md shadow-sm text-sm font-medium text-white bg-amber-400 hover:bg-amber-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            <svg class="" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd"
                d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z"
                clip-rule="evenodd" />
            </svg>
            <a >Book</a>
          </button>
        </span>
        
        <span class="sm:ml-3">
          <button onclick="window.location = 'https\:/\/a7.cpe231.kmutt.in.th/Food.html';" type="button"
            class="ml-2 mr-20 inline-flex items-center px-10 py-2 border-gray-300 rounded-md shadow-sm text-sm font-medium text-white bg-amber-400 hover:bg-amber-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            <!-- Heroicon name: solid/check -->
            <svg class="" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd"
                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                clip-rule="evenodd" />
            </svg>
            <a >Food</a>
          </button>
        </span>
      </div>
    </div>
</div>


<div class="mt-10 sm:mt-0">
  <div class="md:grid md:grid-cols-1 md:gap-1 px-10">
    <div class="md:col-span-1">
    </div>
    <div class="mt-3 md:mt-0 md:col-span-2">
      <form action="#" method="POST">
        <div class="mt-4 shadow overflow-hidden sm:rounded-md">

      <div class="border-t border-gray-200">   

            <div class="mt-4 px-4 flex justify-center"> 
              <div class="layout" style="width: 100%;">
                  
              <table class="table table-bordered table-striped ">
                  <thead>
                    <tr class="table-primary ">
                      
                      <th scope="col"></th>
                      <th scope="col">Activity_Name</th>
                      <th scope="col">RoomID</th>
                      <th scope="col">Participant</th>
                      <th scope="col">Check_IN</th>
                      <th scope="col">Check_Out</th>
                      <th scope="col">Price</th>
                      <th scope="col">Discount</th>
                      <th scope="col">Total</th>
                      <th scope="col"></th>
                      
                    </tr>
                  </thead>
                  <tbody id="myTable">
                    
                  </tbody>
                </table>
                <div class="flex justify-end py-2 ">
                  <button onclick="window.location = 'https\:/\/a7.cpe231.kmutt.in.th/Activity.html';" type="button" class="mb-3 inline-flex items-center px-12 py-2 border-gray-300 rounded-md shadow-sm text-sm font-medium text-white bg-amber-400 hover:bg-amber-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    <svg class="" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                    <a >Add&nbspActivity</a>
                <button type="button" class="ml-4 mb-3 inline-flex items-center px-12 py-2 border-gray-300 rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                  <svg class="" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                  </svg>
                  <a >Pay</a>
                </button>
                <br>
              </div>
              </div>
              </div>
              
              <script>
                  let text = localStorage.getItem('username'); //get value for using username
                  const logindata = JSON.parse(text);
                  // var myArray = [
                  //     {'activityname':'Onsen', 'roomid':'BBD15','participant':'1','checkin':'19:00','checkout':'21:00','price':'1500฿', 'discount':'150฿', 'total':'1350฿','pic': 'jetski.jpg'},
                  //     {'activityname':'Onsen', 'roomid':'BBD15','participant':'1','checkin':'19:00','checkout':'21:00','price':'1500฿', 'discount':'150฿', 'total':'1350฿','pic': 'jetski.jpg' },
                  //     {'activityname':'Onsen', 'roomid':'BBD15','participant':'1','checkin':'19:00','checkout':'21:00','price':'1500฿', 'discount':'150฿', 'total':'1350฿','pic': 'jetski.jpg' },
                      
                  // ]
                  
                  // buildTable(myArray)
              
                  // function buildTable(data){
                  //     var table = document.getElementById('myTable')
              
                  //     for (var i = 0; i < data.length; i++){
                  //         var row = `<tr>
                  //                         <td><img src="pic/${data[i].pic}" alt="Standard Room" width="80px" height="80px"></td>
                  //                         <td>${data[i].activityname}</td>
                  //                         <td>${data[i].roomid}</td>
                  //                         <td>${data[i].participant}</td>
                  //                         <td>${data[i].checkin}</td>
                  //                         <td>${data[i].checkout}</td>
                  //                         <td>${data[i].price}</td>
                  //                         <td>${data[i].discount}</td>
                  //                         <td>${data[i].total}</td>
                  //                         <td><button onclick="window.location = 'https\:/\/a7.cpe231.kmutt.in.th/Activity.html';" type="button" class="inline-flex items-center px-1 py-1 border-gray-300 rounded-md shadow-sm text-sm font-medium text-white bg-gray-400 hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                  //                           <svg class="" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  //                             <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                  //                           </svg>
                  //                           <a>Cancel</a>
                  //                           </button></td>
                                          
                  //                   </tr>`
                  //         table.innerHTML += row
                  //     }
                  // }
                  fetch('http://localhost:3333/get_Card_actvity', {
                  method: 'POST', // or 'PUT'
                  headers: {
                     'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(logindata),
                  })
                  .then(response => response.json())
                  .then(data => {
                  if (data.status === 'success') {
                     
                     var row_activity = ''
                     
                     for (let i = 0; i < data.result_Card_activity.length; i++) {
                        var Check_in_user = new Date(data.result_Card_activity[i].check_in);
                        // Check_in_user.setHours( Check_in_user.getHours() - 7 );
                        var Check_in_user_time = Check_in_user.toLocaleTimeString();
                        var Check_in_user_date = Check_in_user.toLocaleDateString();

                        var Check_out_user = new Date(data.result_Card_activity[i].check_out);
                        // Check_out_user.setHours( Check_out_user.getHours() - 7 );
                        var Check_out_user_time = Check_out_user.toLocaleTimeString();
                        var Check_out_user_date = Check_out_user.toLocaleDateString();
                        

                        var get_name_activity = data.result_Card_activity[i].activity_no
                        var name_activity_split = get_name_activity.split("0");
                        var name_activity = name_activity_split[0] 
               
                        if(name_activity == "Spa"){
                           row_activity += `<tr>
                                             <td><img src="pic/spa.jpg" alt="Standard Room" width="80px" height="80px"></td>
                                             <td>${data.result_Card_activity[i].activity_no}</td>
                                             <td>${data.result_Card_activity[i].room_id}</td>
                                             <td>${data.result_Card_activity[i].participant}</td>
                                             <td>${Check_in_user_date + " " + Check_in_user_time}</td>
                                             <td>${Check_out_user_date + " " + Check_out_user_time}</td>
                                             <td>${data.result_Card_activity[i].total + data.result_Card_activity[i].total_discount}</td>
                                             <td>${data.result_Card_activity[i].total_discount}</td>
                                             <td>${data.result_Card_activity[i].total}</td>
                                             <td><button onclick ="DeleteBooking('`+data.result_Card_activity[i].booking_activity_id+`','`+data.result_Card_activity[i].user_and_promotion+`')" type="button" class="inline-flex items-center px-1 py-1 border-gray-300 rounded-md shadow-sm text-sm font-medium text-white bg-gray-400 hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                             <svg class="" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                                             </svg>
                                             <a>Cancel</a>
                                             </button></td>
                                       </tr>`;
                        }else if(name_activity == "Onsen"){
                           row_activity += `<tr>
                                             <td><img src="pic/onsen.jpg" alt="Standard Room" width="80px" height="80px"></td>
                                             <td>${data.result_Card_activity[i].activity_no}</td>
                                             <td>${data.result_Card_activity[i].room_id}</td>
                                             <td>${data.result_Card_activity[i].participant}</td>
                                             <td>${Check_in_user_date + " " + Check_in_user_time}</td>
                                             <td>${Check_out_user_date + " " + Check_out_user_time}</td>
                                             <td>${data.result_Card_activity[i].total + data.result_Card_activity[i].total_discount}</td>
                                             <td>${data.result_Card_activity[i].total_discount}</td>
                                             <td>${data.result_Card_activity[i].total}</td>
                                             <td><button onclick="window.location = 'https\:/\/a7.cpe231.kmutt.in.th/Activity.html';" type="button" class="inline-flex items-center px-1 py-1 border-gray-300 rounded-md shadow-sm text-sm font-medium text-white bg-gray-400 hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                             <svg class="" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                                             </svg>
                                             <a>Cancel</a>
                                             </button></td>
                                       </tr>`;
                        }else{
                           row_activity += `<tr>
                                             <td><img src="pic/jetski.jpg" alt="Standard Room" width="80px" height="80px"></td>
                                             <td>${data.result_Card_activity[i].activity_no}</td>
                                             <td>${data.result_Card_activity[i].room_id}</td>
                                             <td>${data.result_Card_activity[i].participant}</td>
                                             <td>${Check_in_user_date + " " + Check_in_user_time}</td>
                                             <td>${Check_out_user_date + " " + Check_out_user_time}</td>
                                             <td>${data.result_Card_activity[i].total + data.result_Card_activity[i].total_discount}</td>
                                             <td>${data.result_Card_activity[i].total_discount}</td>
                                             <td>${data.result_Card_activity[i].total}</td>
                                             <td><button onclick="window.location = 'https\:/\/a7.cpe231.kmutt.in.th/Activity.html';" type="button" class="inline-flex items-center px-1 py-1 border-gray-300 rounded-md shadow-sm text-sm font-medium text-white bg-gray-400 hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                             <svg class="" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                                             </svg>
                                             <a>Cancel</a>
                                             </button></td>
                                       </tr>`;
                        }
                     }
                     //console.log(data.result_Card_activity.length)
                     document.getElementById("myTable").innerHTML = row_activity;        
               }
               else {
                  console.log(data.message)
                  alert('Failed!!')
               }
            })
            .catch((error) => {
                  console.error();
            });
            

            function DeleteBooking(booking_activity_id,user_and_promotion){
               console.log(booking_activity_id)
               console.log(user_and_promotion)
               if(confirm("Are you sure to cancel booking ?") == true){
                  var for_delete_booking = {
                     booking_activity_id: booking_activity_id,
                     user_and_promotion: user_and_promotion
                  }
                   //https://a7.cpe231.kmutt.in.th/api/delete_booking
                   fetch('http://localhost:3333/delete_activity', {
                  method: 'POST', // or 'PUT'
                  headers: {
                    'Content-Type': 'application/json',
                  },
                        body: JSON.stringify(for_delete_booking),
                   })
                  .then(response => response.json())
                  .then(data => {
                  if(data.status === 'ok'){
                     alert('Cancel Succesful !!')
                     document.location.reload(true);
                     //window.location = 'https://a7.cpe231.kmutt.in.th/CartRoom.html'
                  }
                  else{
                     alert('Cancel Error, something should be wrong')
                     window.location = 'https://a7.cpe231.kmutt.in.th/CartRoom.html'
                  }
                  })
                  .catch((err) => {
                  console.log(err);
                  })  
               } // end if confirm
            }
              
              </script> 
        </div>
        </dl>
      </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>