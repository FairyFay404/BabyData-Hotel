<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Details</title>
        <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
       
    </head>
    <body>
      <div class="max-w-10xl mx-auto px-10 sm:px-10"></div>
      <div class=" items-center border-gray-100 py-6 md:justify-start  text-white bg-cyan-600">
        <div class="flex justify-start lg:w-0 lg:flex-1">
          <a href="">
            <span class="sr-only">Workflow</span>
            &emsp;&emsp;&emsp;&emsp;
            <a class="navbar-brand flex text-center text-2xl font-extrabold">Details 
          </a>
        </div>
      </div>
      <br><br>
      <div class="hidden " aria-hidden="true">
        <div class="py-5">
          <div class="border-t border-gray-200"></div>
        </div>
      </div>
      
      <div class="mt-10 sm:mt-0">
        <div class="md:grid md:grid-cols-3 md:gap-6">
          <div class="md:col-span-1">
            <div class="px-4 sm:px-0">
              <h3 class="text-2xl font-medium leading-6 text-gray-900" >&emsp;&emsp;&emsp;Spa</h3><br>
              &emsp;&emsp;&emsp;&emsp;&ensp;
              <a class="mt-1 text-1xl text-gray-500 sm:mt-3 sm:col-span-1">The spa that will make you feel relaxed and relieve 
                <br>&emsp;&emsp;&emsp;&emsp;&ensp;&nbsp;stress from a hard working day. Our hotel has 
                <br>&emsp;&emsp;&emsp;&emsp;&ensp;&nbsp;massage specialists that will make you fall in love.</a><br><br>
              <img src="pic/spa.jpg" alt="Standard Room" width="1000px" height="1000px" class="sm:px-20">
            </div>
          </div>
          <div class="mt-5 md:mt-0 md:col-span-2">
            <form action="#" method="POST" id="book">
              <div class="shadow overflow-hidden sm:rounded-md">
                <div class="px-4 py-5 bg-white sm:p-6">
                  <a class="text-sm text-gray-500 sm:mt-3">Price</a>
                  <a  class="text-2xl text-gray-700 sm:mt-3" >&emsp;à¸¿500 per participant</a><br><br>
                  
                  <div class="grid grid-cols-3 gap-3">

                    <div class="col-span-6 sm:col-span-1">
                        <label for="CheckIn" class="block text-sm font-medium text-gray-700">Check In</label>
                        <select id="CheckIn" name="CheckIn" autocomplete="country-name" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-cyan-600 focus:border-cyan-600 sm:text-sm">
                            <option>Select</option>
                          <option>12:00</option>
                          <option>13:00</option>
                          <option>14:00</option>
                          <option>15:00</option>
                          <option>16:00</option>
                          <option>17:00</option>
                          <option>18:00</option>
                          <option>19:00</option>
                          <option>20:00</option>
                          <option>21:00</option>
                          <option>22:00</option>
                          <option>23:00</option>
                        </select>
                      </div>

                    <div class="col-span-6 sm:col-span-1">
                      <label for="CheckOut" class="block text-sm font-medium text-gray-700">Check Out</label>
                      <select id="CheckOut" name="CheckOut" autocomplete="country-name" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-cyan-600 focus:border-cyan-600 sm:text-sm">
                        <option>Select</option>
                          <option>13:00</option>
                          <option>14:00</option>
                          <option>15:00</option>
                          <option>16:00</option>
                          <option>17:00</option>
                          <option>18:00</option>
                          <option>19:00</option>
                          <option>20:00</option>
                          <option>21:00</option>
                          <option>22:00</option>
                          <option>23:00</option>
                          <option>00:00</option>
                      </select>
                    </div>
                  </div><br>
                  
                  <div class="grid grid-cols-3 gap-3">

                    <div class="col-span-6 sm:col-span-1">
                        <label for="Participant" class="block text-sm font-medium text-gray-700">Participant</label>
                        <input oninput="Newdisplay()" type="text" name="Participant" id="Participant" autocomplete="given-name" class="mt-1 focus:ring-cyan-600 focus:border-cyan-600 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                      </div>

                    <div class="col-span-6 sm:col-span-1">
                      <label for="RoomID" class="block text-sm font-medium text-gray-700">RoomID</label>
                      <select id="RoomID" name="RoomID" autocomplete="country-name" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-cyan-600 focus:border-cyan-600 sm:text-sm">
                        <!-- <option>RoomID</option>
                        <option>BB299</option>
                        <option>BB252</option>
                        <option>BB233</option> -->
                      </select>
                    </div>
                  </div><br>
                    
                  <div class="grid grid-cols-3 gap-3">
                    <div class="col-span-6 sm:col-span-1">
                        <label for="Promotion" class="block text-sm font-medium text-gray-700">Promotion</label>
                        <select id="Promotion" onchange = "Newdisplay()" name="Promotion" autocomplete="country-name" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-cyan-600 focus:border-cyan-600 sm:text-sm">
                          <option>Select</option>
                          <option>A500</option>
                          <option>Promotion2</option>
                          <option>Promotion3</option>
                        </select>
                      </div>
                      
                      
                  </div><br>
                  
                  <h3 id="totalresult">Total</h3>
                </div>
                <div class="px-4 py-3 bg-gray-50 text-right sm:px-6">
                  <button onclick="window.location = 'https\:/\/a7.cpe231.kmutt.in.th/Activity.html';" type="button" class="inline-flex justify-center py-2 px-7 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-gray-400 hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    <a>Cancel</a></button>

                  <button type="submit" id="No_activity" value ="Spa" class="inline-flex justify-center py-2 px-10 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    <a>Book</a></button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
      
      <div class="hidden sm:block" aria-hidden="true">
        <div class="py-5">
          <div class="border-t border-gray-200"></div>
        </div>
      </div>

      <script>
         //-----------------------about UI---------------------//
         
         var Array_Promotion_discount = {
            promotion_id : [],
            discount : []
         }
         var hours

         function Newdisplay(){
            var Act = parseInt(500)
            var num =document.getElementById("Participant").value
            var temp = document.getElementById('Promotion').value
            var start = document.getElementById('CheckIn').value
            var stop = document.getElementById('CheckOut').value
            var temp1 = start.split(":")
            var temp2 = stop.split(":")
            console.log(start + stop)
      
           
            if(temp2[0] == 0){
              temp2[0] = 24
            }
            hours = temp2[0] - temp1[0]
            console.log(hours)
            
            var select_discount
            //console.log(Array_Promotion_discount.discount[0])
            if(temp == "null"){
               document.getElementById("totalresult").innerHTML ="Total : "+ num*Act*hours
            }else{
               for(let i=0; i< Array_Promotion_discount.promotion_id.length;i++){
                  if(Array_Promotion_discount.promotion_id[i] == temp)
                     select_discount = Array_Promotion_discount.discount[i] 
               }
               console.log(select_discount)
               
               document.getElementById("totalresult").innerHTML ="Total : "+ num*Act* (100-select_discount)/100 *hours
            }
         }
         // -------------------------------------------------- //   
         let text = localStorage.getItem('username'); //get value for using username
         const logindata = JSON.parse(text);
         //{username: value , password: value}
         

         fetch('https://a7.cpe231.kmutt.in.th/api/get_actvity', {
            method: 'POST', // or 'PUT'
            headers: {
               'Content-Type': 'application/json',
            },
            body: JSON.stringify(logindata),
            })
            .then(response => response.json())
            .then(data => {
               if (data.status === 'success') {
                  
                  var options_room = ''
                  options_room = '<option value='+null+'>Not Select Room</option>';
                  for (let i = 0; i < data.result_room_id.length; i++) {
                     options_room += '<option value="' + data.result_room_id[i].room_id + '">' + data.result_room_id[i].room_id + '</option>';
                  }
                  console.log(data.result_room_id[0].room_id)
                  document.getElementById("RoomID").innerHTML = options_room;

                  var options_promotion = ''
                  options_promotion = '<option value='+null+'>Not use promotion</option>';
                  for (let i = 0; i < data.result_promotionId_discount.length; i++) {
                     options_promotion += '<option value="' + data.result_promotionId_discount[i].promotion_id + '">' + "Discount " + data.result_promotionId_discount[i].discount + " %"+ '</option>';
                     Array_Promotion_discount.promotion_id.push(data.result_promotionId_discount[i].promotion_id)
                     Array_Promotion_discount.discount.push( data.result_promotionId_discount[i].discount)
                  }
                  console.log(Array_Promotion_discount)
                  document.getElementById("Promotion").innerHTML = options_promotion;
                  

               
               }
               else {
                  console.log(data.message)
                  alert('Failed!!')
               }
            })
            .catch((error) => {
                  console.error();
            });
            


         //---- -----------------Fetch Post ----------------//
         

         const book = document.getElementById("book");
         book.addEventListener('submit', (event) => {

            event.preventDefault(); // protect refresh / reload 
            // const data = {}
            // new FormData(login).forEach((value, key) => data[key] = value)
            var data_participant = document.getElementById("Participant").value
            var data_total = parseInt(500) * data_participant * hours
            var data_user_and_promotion = document.getElementById("Promotion").value
            var data_check_in = document.getElementById("CheckIn").value
            var data_check_out = document.getElementById("CheckOut").value
            var data_name_activity = document.getElementById("No_activity").value

            console.log(logindata.username)
            console.log(data_total)
            console.log(data_participant)
            console.log(data_user_and_promotion)
            console.log(data_check_in)
            console.log(data_check_out)
            console.log(data_name_activity)

            let NewJson = {
               username : logindata.username,
               total : data_total,
               participant : data_participant,
               promotion_id : data_user_and_promotion, 
               check_in : data_check_in,
               check_out : data_check_out,
               name_activity : data_name_activity
            }

            fetch('https://a7.cpe231.kmutt.in.th/api/book_activity', {
            method: 'POST', // or 'PUT'
            headers: {
               'Content-Type': 'application/json',
            },
            body: JSON.stringify(NewJson),
            })
            .then(response => response.json())
            .then(data => {
               if (data.status === 'success') {
                  console.log(data.message)
                 alert('booking activity success!!')
               }
               else {
                  console.log(data.message)
                  alert('Failed!!' + ' ' + data.message)
               }
            })
            .catch((error) => {
                  console.error();
            });
         })
         
      </script>
    </body>
</html>